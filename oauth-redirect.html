<!doctype html>
<html>
<head><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/></head>
<body>
  <div id="status">Redirecting…</div>
  <script>
  (function () {
    const qs = new URLSearchParams(window.location.search || window.location.hash.replace('#','?') || '');
    const userId = qs.get('userId');
    const secret = qs.get('secret');
    const error = qs.get('error');
    // Primary app scheme (matches Appwrite platform and app.json)
    const APP_SCHEME = 'appwrite-callback-6854257a000c3a519205://auth';
    const ALT_SCHEME = 'fxlens://oauth';

    if (error) {
      document.getElementById('status').innerText = 'OAuth Error: ' + error;
      return;
    }
    if (userId && secret) {
      const target = `${APP_SCHEME}?userId=${encodeURIComponent(userId)}&secret=${encodeURIComponent(secret)}`;
      // Try multiple redirect methods
      try { window.location.replace(target); } catch(e){}
      setTimeout(()=>{ try{ window.location.href = target; }catch(e){} }, 200);
      setTimeout(()=>{ 
        try {
          const intent = 'intent://' + target.replace(/^[^:]+:\/\//,'') + '#Intent;scheme=' + target.split(':')[0] + ';package=com.danieldon.fxlens;end';
          window.location.href = intent;
        } catch(e){}
      }, 600);
      // clickable fallback
      document.body.innerHTML = `<p>If redirect fails, <a href="${target}">open the app</a></p>`;
    } else {
      document.getElementById('status').innerText = 'Missing userId/secret in callback — show the full URL in console for debugging';
      console.log('Full redirect URL:', window.location.href);
    }
  })();
  </script>
</body>
</html>
